<app-connection-required
  *ngIf="!gitlabAuthService.isAuthenticated()"
  [authenticationService]="gitlabAuthService"
  externalServiceName="Gitlab"
></app-connection-required>

<form
  *ngIf="gitlabAuthService.isAuthenticated()"
  [formGroup]="issueCreationForm"
  class="mx-auto max-w-[700px]"
>
  <div
    class="mb-6 font-bold border-2 rounded-xl border-red-500 p-4 text-red-500"
  >
    <p>Attention : ce formulaire est une béta !</p>
    <p>
      Le formulaire officiel pour faire des issues de réintégration est
      <a
        class="underline text-blue-500"
        href="http://10.128.88.23:6969/reintegration/reintegration.html"
        >ici</a
      >
    </p>
  </div>

  <div class="flex flex-col gap-6">
    <app-custom-input
      [label]="'Type de développement'"
      [selectOptions]="developmentTypeOptions"
      [control]="issueCreationForm.controls['developmentType']"
    ></app-custom-input>

    <app-custom-input
      [label]="
        isCurrentDevelopmentTypeModificationAnalyse()
          ? 'Numéro de l\'analyse'
          : 'Périmètre'
      "
      [control]="issueCreationForm.controls['scope']"
    ></app-custom-input>

    <app-custom-input
      [label]="'Titre'"
      [control]="issueCreationForm.controls['title']"
    ></app-custom-input>

    <app-custom-input
      [label]="'Description'"
      [isMultiline]="true"
      [control]="issueCreationForm.controls['description']"
    ></app-custom-input>

    <div class="flex flex-col">
      <label class="flex mb-2" for="project-list"
        >Projet
        <p class="text-red-500">*</p></label
      >
      <app-project-list
        id="project-list"
        formControlName="selectedProject"
        [ngClass]="{
          'border-red-500 border-2 rounded-lg':
            formControlInvalid('selectedProject')
        }"
      ></app-project-list>
      <span
        class="text-sm text-red-500"
        *ngIf="formControlInvalid('selectedProject')"
        >Veuillez selectionner une valeur</span
      >
    </div>

    <app-custom-input
      [label]="'Est une correction de bug ?'"
      [yesNoSelector]="true"
      [control]="issueCreationForm.controls['isBugCorrection']"
    ></app-custom-input>

    <app-custom-input
      [label]="'Doit être mentionné dans le \'quoi de neuf\' ?'"
      [yesNoSelector]="true"
      [control]="issueCreationForm.controls['isQuoiDeNeuf']"
    ></app-custom-input>

    <div class="flex flex-col">
      <label class="flex mb-2" for="milestone"
        >Milestone
        <p class="text-red-500">*</p></label
      >
      <app-milestone-list
        [milestones]="milestones"
        formControlName="selectedMilestones"
        [ngClass]="{
          'border-red-500 border-2 rounded-lg':
            formControlInvalid('selectedMilestones')
        }"
      ></app-milestone-list>
      <span
        class="text-sm text-red-500"
        *ngIf="formControlInvalid('selectedMilestones')"
        >Veuillez sélectionner au moins une valeur</span
      >
    </div>

    <fieldset class="border-2 border-gray-400 rounded-md p-4">
      <legend class="p-2 text-lg font-semibold">
        Résumé de la réintégration
      </legend>
      <app-new-issue-actions-summary
        [issue]="futureIssue"
        [project]="selectedProject"
        [selectedMilestones]="selectedMilestones"
      ></app-new-issue-actions-summary>
      <div class="flex gap-2 items-center justify-end mt-6">
        <span
          class="text-sm text-gray-500 italic"
          *ngIf="!issueCreationForm.valid"
          >Veuillez remplir tous les champs obligatoires</span
        >
        <span *ngIf="pendingCreationResult" class="text-sm text-gray-500 italic"
          >Création en cours...</span
        >
        <button
          (click)="createNewIssue()"
          [disabled]="!issueCreationForm.valid"
          class="p-2 float-end border-gray-400 rounded-md bg-purple-700 text-white disabled:bg-gray-200 disabled:text-gray-500"
        >
          Créer une issue de réintégration
        </button>
      </div>
    </fieldset>
  </div>
</form>
